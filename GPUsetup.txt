    sudo apt-get update

    sudo apt-get upgrade -y

    sudo apt-get dist-upgrade -y

    sudo apt-get install build-essential ubuntu-desktop -y

Disable the Nouveau kernel driver, which is incompatible with the NVIDIA driver. (Only use the NVIDIA driver on NV VMs.) To do this, create a file in /etc/modprobe.dnamed nouveau.conf with the following contents:

    blacklist nouveau

    blacklist lbm-nouveau

Reboot the VM and reconnect. Exit X server:
bash

    sudo systemctl stop lightdm.service

    wget -O NVIDIA-Linux-x86_64-384.73-grid.run https://go.microsoft.com/fwlink/?linkid=849941  

    chmod +x NVIDIA-Linux-x86_64-384.73-grid.run

    sudo ./NVIDIA-Linux-x86_64-384.73-grid.run

When you're asked whether you want to run the nvidia-xconfig utility to update your X configuration file, select Yes.

    sudo cp /etc/nvidia/gridd.conf.template /etc/nvidia/gridd.conf

Add the following to /etc/nvidia/gridd.conf:

    IgnoreSP=TRUE

Cuda:

    CUDA_REPO_PKG=cuda-repo-ubuntu1604_9.0.176-1_amd64.deb

    wget -O /tmp/${CUDA_REPO_PKG} http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/${CUDA_REPO_PKG} 

    sudo dpkg -i /tmp/${CUDA_REPO_PKG}

    sudo apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/7fa2af80.pub 

    rm -f /tmp/${CUDA_REPO_PKG}

    sudo apt-get update

    sudo apt-get install cuda-drivers

    sudo apt-get install cuda

Reboot the VM and proceed to verify the installation.

For updates:

    sudo apt-get update

    sudo apt-get upgrade -y

    sudo apt-get dist-upgrade -y

    sudo apt-get install cuda-drivers

    sudo reboot